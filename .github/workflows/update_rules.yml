name: Update Rules

on:
  # å®šæ—¶è§¦å‘ï¼šæ¯å¤© UTC æ—¶é—´ 22:00 (åŒ—äº¬æ—¶é—´æ¬¡æ—¥ 06:00)
  schedule:
    - cron: '0 22 * * *'
  
  # æ‰‹åŠ¨è§¦å‘ï¼šå…è®¸åœ¨ Actions é¡µé¢æ‰‹åŠ¨ç‚¹å‡»è¿è¡Œ
  workflow_dispatch:
  
  # ä»£ç å˜åŠ¨è§¦å‘ï¼šå½“ release.py æˆ–ç›¸å…³æ–‡ä»¶ä¿®æ”¹æ—¶è‡ªåŠ¨è¿è¡Œ
  push:
    paths:
      - 'release.py'
      - '.github/workflows/update_rules.yml'

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
      # 1. æ£€å‡ºä»£ç 
      - name: Checkout codebase
        uses: actions/checkout@v4

      # 2. è®¾ç½® Python ç¯å¢ƒ
      - name: Set up Python 3
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      # 3. è¿è¡Œæ‚¨çš„è„šæœ¬
      - name: Run release script
        run: |
          echo "ğŸ“‚å½“å‰ç›®å½•ï¼š"
          pwd
          echo "ğŸ“‚ å½“å‰ç›®å½•æ–‡ä»¶åˆ—è¡¨ï¼š"
          ls -R
          echo "--------------------------------"
          python release.py
          echo "âœ… è§„åˆ™ç”Ÿæˆå®Œæ¯•ï¼Œå‡†å¤‡å‘å¸ƒ..."
          ls -R gfwlist2_output  # æ‰“å°ç›®å½•ç»“æ„ä»¥ä¾›è°ƒè¯•
      # 4. å°†ç”Ÿæˆçš„æ–‡ä»¶æ¨é€åˆ° release åˆ†æ”¯
      - name: Upload Release
        uses: softprops/action-gh-release@v2
        with:
          # å›ºå®šä½¿ç”¨ 'latest' æ ‡ç­¾ï¼Œä¿è¯è®¢é˜…é“¾æ¥ä¸å˜
          tag_name: latest
          # Release çš„æ ‡é¢˜
          name: Auto-updated Rules
          body: "Rules updated on $(date +'%Y-%m-%d %H:%M:%S')"
          draft: false
          prerelease: false
          # æ ‡è®°ä¸ºæœ€æ–°ç‰ˆæœ¬
          make_latest: true
          files: gfwlist2_output/*
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
